Intent

Ship a C#/.NET 8 CLI (xws) that connects to Hyperliquid WebSocket, streams messages to stdout as JSONL, supports public + private (when env vars present), and is resilient to disconnects.

Target user + primary use case

Engineers/quants who want a raw, scriptable WS pump they can pipe into tooling (jq, files, other processes) and later extend with adapters/normalizers.

MVP scope (IN)

Windows-primary, but no Windows-only assumptions (Linux later with minimal change).

Commands (Hyperliquid adapter):

xws hl subscribe trades --symbol <native_coin> → connect WS, subscribe, print incoming WS frames as JSONL to stdout.

xws hl symbols [--filter <str>] → list valid symbols/instruments as raw JSONL (discovery to avoid symbol mapping).

xws hl subscribe positions (name can be positions / account) → private proof using user address env var, prints WS frames as JSONL.

IO contract

stdout: WS messages only, one JSON object per line (JSONL)

stderr: logs/status/errors only

Reconnect robustness

On drop: exponential backoff, reconnect, and re-subscribe to prior subscriptions.

After 3 failed reconnect attempts: exit non-zero with clear error.

Clean shutdown

Ctrl+C exits cleanly with exit code 0 (unless fatal error path).

Hyperliquid WS endpoint + subscription format reference: mainnet/testnet WS URLs and {"method":"subscribe","subscription":{...}} structure.

Non-goals (OUT)

Normalized schema / cross-exchange translation layer

Local order management/state

Persistence (db/files)

Fancy TUI

Trading actions / signed order placement (Exchange endpoint)

Constraints

Secrets only via env vars; never write keys/secrets to disk.

Minimal dependencies (OK: System.CommandLine NuGet).

Symbols are exchange-native only (no BTC/USDT mapping in M1). (Note HL has specific coin naming rules, especially spot indices; discovery command exists to avoid UX pain.)

Milestone 1 Definition of Done

On Windows:

xws hl subscribe trades --symbol <native> connects and prints ≥ 50 WS JSONL messages within 30s.

Ctrl+C exits cleanly with code 0.

If socket drops: retries with exponential backoff, re-subscribes; after 3 failed reconnect attempts exits non-zero with a clear error.

--help shows commands/options.

Done Enough declaration (mandatory)

This milestone is done even if the following are not perfect:

log formatting / verbosity

UX polish of error messages

coverage of every HL subscription type

handling every edge-case WS frame or rare server behavior

Repo starter pack files to create

README.md (structure only)

DECISIONS.md

agents.md

PROMPTS.md

CHECKLIST.md

Minimal architecture

xws (CLI)

Commands/ (System.CommandLine wiring)

Exchanges/Hyperliquid/ (HL-specific command building + symbol discovery)

Core/WebSocketRunner (connect loop, backoff, reconnect, resubscribe)

Core/Output (stdout JSONL writer; stderr logger)

Core/Env (env var retrieval/validation)

Hyperliquid specifics to implement against:

WS URL(s): wss://api.hyperliquid.xyz/ws (mainnet), wss://api.hyperliquid-testnet.xyz/ws (testnet).

Subscriptions include trades and user/account feeds like clearinghouseState etc.

Acceptance + validation baseline commands

From repo root:

dotnet --version
dotnet restore
dotnet build -c Release
dotnet run --project src/xws -- --help
dotnet run --project src/xws -- hl symbols --filter BTC
dotnet run --project src/xws -- hl subscribe trades --symbol SOL